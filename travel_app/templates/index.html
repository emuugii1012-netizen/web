<!DOCTYPE html>
<html lang="mn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê—è–ª–ª—ã–Ω –ë“Ø—Ä—Ç–≥—ç–ª–∏–π–Ω –°–∏—Å—Ç–µ–º</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>üåç –ê—è–ª–ª—ã–Ω –ë“Ø—Ä—Ç–≥—ç–ª–∏–π–Ω –°–∏—Å—Ç–µ–º</h1>
            <p>–¢–∞ ”©”©—Ä–∏–π–Ω —Å–æ–Ω–≥–æ—Å–æ–Ω –∞—è–ª–ª—ã–Ω —á–∏–≥–ª—ç–ª—ç—ç –±“Ø—Ä—Ç–≥“Ø“Ø–ª–Ω—ç “Ø“Ø</p>
        </header>

        <!-- Flash –º–µ—Å—Å–µ–∂“Ø“Ø–¥ -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- –ë“Ø—Ä—Ç–≥—ç–ª–∏–π–Ω —Ñ–æ—Ä–º -->
        <form id="registrationForm" action="{{ url_for('submit') }}" method="POST">
            
            <!-- –ê—è–ª–ª—ã–Ω —á–∏–≥–ª—ç–ª —Å–æ–Ω–≥–æ—Ö -->
            <div class="form-group">
                <label for="route">–ê—è–ª–ª—ã–Ω —á–∏–≥–ª—ç–ª:</label>
                <select id="route" name="route" required onchange="updatePackages()">
                    <option value="">-- –ß–∏–≥–ª—ç–ª —Å–æ–Ω–≥–æ–Ω–æ —É—É --</option>
                    {% for route, date in routes.items() %}
                        <option value="{{ route }}" data-date="{{ date }}">{{ route }} ({{ date }})</option>
                    {% endfor %}
                </select>
            </div>

            <!-- –ê—è–ª–ª—ã–Ω –±–∞–≥—Ü —Å–æ–Ω–≥–æ—Ö -->
            <div class="form-group">
                <label for="package">–ê—è–ª–ª—ã–Ω –±–∞–≥—Ü:</label>
                <select id="package" name="package" required onchange="updatePrice()">
                    <option value="">-- –≠—Ö–ª—ç—ç–¥ —á–∏–≥–ª—ç–ª —Å–æ–Ω–≥–æ–Ω–æ —É—É --</option>
                </select>
            </div>

            <!-- “Æ–Ω–∏–π–Ω –º—ç–¥—ç—ç–ª—ç–ª —Ö–∞—Ä—É—É–ª–∞—Ö -->
            <div id="priceInfo" class="price-info" style="display: none;">
                <div class="price-row">
                    <span class="label">–ù–∏–π—Ç “Ø–Ω—ç:</span>
                    <span id="totalPrice" class="price">0 ‚ÇÆ</span>
                </div>
                <div class="price-row deposit">
                    <span class="label">50% —É—Ä—å–¥—á–∏–ª–≥–∞–∞:</span>
                    <span id="depositAmount" class="price">0 ‚ÇÆ</span>
                </div>
                <div class="price-row">
                    <span class="label">–•”©–¥–ª”©—Ö –æ–≥–Ω–æ–æ:</span>
                    <span id="departureDate" class="date">-</span>
                </div>
            </div>

            <hr>

            <!-- –•—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω –º—ç–¥—ç—ç–ª—ç–ª -->
            <h3>–•—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω –º—ç–¥—ç—ç–ª—ç–ª</h3>

            <div class="form-group">
                <label for="full_name">–ë“Ø—Ç—ç–Ω –Ω—ç—Ä:</label>
                <input type="text" id="full_name" name="full_name" required 
                       placeholder="–ñ–∏—à—ç—ç: –ë–æ–ª–¥–±–∞–∞—Ç–∞—Ä –ë–∞—Ç—Å–∞–π—Ö–∞–Ω">
            </div>

            <div class="form-group">
                <label for="phone">–£—Ç–∞—Å–Ω—ã –¥—É–≥–∞–∞—Ä (8 –æ—Ä–æ–Ω):</label>
                <input type="text" id="phone" name="phone" required 
                       pattern="\d{8}" maxlength="8"
                       placeholder="99001122">
                <small>–ó”©–≤—Ö”©–Ω 8 –æ—Ä–æ–Ω—Ç–æ–π —Ç–æ–æ –æ—Ä—É—É–ª–Ω–∞ —É—É</small>
            </div>

            <div class="form-group">
                <label for="email">–ò-–º—ç–π–ª:</label>
                <input type="email" id="email" name="email" required 
                       placeholder="example@email.com">
            </div>

            <hr>

            <!-- –£—Ä—å–¥—á–∏–ª–≥–∞–∞ —Ç”©–ª—Å”©–Ω —ç—Å—ç—Ö–∏–π–≥ –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞—Ö -->
            <div class="form-group checkbox-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="deposit_confirmed" name="deposit_confirmed" required>
                    <span>–ë–∏ –Ω–∏–π—Ç –∞—è–ª–ª—ã–Ω –∑–∞—Ä–¥–ª—ã–Ω 50%-–∏–π–≥ —É—Ä—å–¥—á–∏–ª–≥–∞–∞ —Ç”©–ª—Å”©–Ω –±–æ–ª–æ—Ö—ã–≥ –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∂ –±–∞–π–Ω–∞</span>
                </label>
            </div>

            <!-- Submit —Ç–æ–≤—á -->
            <button type="submit" class="submit-btn">üìù –ë“Ø—Ä—Ç–≥—ç–ª –∏–ª–≥—ç—ç—Ö</button>
        </form>

        <footer>
            <p>–ê—Å—É—É–ª—Ç –±–∞–π–≤–∞–ª —Ö–æ–ª–±–æ–æ –±–∞—Ä–∏–Ω–∞ —É—É: <strong>+976 1234-5678</strong></p>
        </footer>
    </div>

    <script>
        // –ê—è–ª–ª—ã–Ω –±–∞–≥—Ü—É—É–¥—ã–Ω ”©–≥”©–≥–¥”©–ª
        const packagesData = {{ packages|tojson }};

        // –ß–∏–≥–ª—ç–ª —Å–æ–Ω–≥–æ—Ö–æ–¥ –±–∞–≥—Ü—É—É–¥—ã–≥ —à–∏–Ω—ç—á–ª—ç—Ö
        function updatePackages() {
            const routeSelect = document.getElementById('route');
            const packageSelect = document.getElementById('package');
            const selectedRoute = routeSelect.value;

            // –ë–∞–≥—Ü —Ç–∞–ª–±–∞—Ä—ã–≥ —Ü—ç–≤—ç—Ä–ª—ç—Ö
            packageSelect.innerHTML = '<option value="">-- –ë–∞–≥—Ü —Å–æ–Ω–≥–æ–Ω–æ —É—É --</option>';
            
            // “Æ–Ω–∏–π–Ω –º—ç–¥—ç—ç–ª—ç–ª –Ω—É—É—Ö
            document.getElementById('priceInfo').style.display = 'none';

            if (selectedRoute && packagesData[selectedRoute]) {
                // –°–æ–Ω–≥–æ–≥–¥—Å–æ–Ω —á–∏–≥–ª—ç–ª–∏–π–Ω –±–∞–≥—Ü—É—É–¥—ã–≥ –Ω—ç–º—ç—Ö
                const packages = packagesData[selectedRoute];
                for (let packageName in packages) {
                    const option = document.createElement('option');
                    option.value = packageName;
                    option.textContent = packageName + ' - ' + packages[packageName].toLocaleString() + ' ‚ÇÆ';
                    option.setAttribute('data-price', packages[packageName]);
                    packageSelect.appendChild(option);
                }
            }
        }

        // –ë–∞–≥—Ü —Å–æ–Ω–≥–æ—Ö–æ–¥ “Ø–Ω–∏–π–≥ —Ö–∞—Ä—É—É–ª–∞—Ö
        function updatePrice() {
            const routeSelect = document.getElementById('route');
            const packageSelect = document.getElementById('package');
            const priceInfo = document.getElementById('priceInfo');
            
            const selectedRoute = routeSelect.value;
            const selectedPackage = packageSelect.value;

            if (selectedRoute && selectedPackage) {
                const price = packagesData[selectedRoute][selectedPackage];
                const deposit = price / 2;
                const departureDate = routeSelect.options[routeSelect.selectedIndex].getAttribute('data-date');

                // “Æ–Ω–∏–π–Ω –º—ç–¥—ç—ç–ª—ç–ª —Ö–∞—Ä—É—É–ª–∞—Ö
                document.getElementById('totalPrice').textContent = price.toLocaleString() + ' ‚ÇÆ';
                document.getElementById('depositAmount').textContent = deposit.toLocaleString() + ' ‚ÇÆ';
                document.getElementById('departureDate').textContent = departureDate;
                priceInfo.style.display = 'block';
            }
        }

        // –§–æ—Ä–º –∏–ª–≥—ç—ç—Ö—ç—ç—Å ”©–º–Ω”© –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞–ª—Ç
        document.getElementById('registrationForm').addEventListener('submit', function(e) {
            const phone = document.getElementById('phone').value;
            const depositConfirmed = document.getElementById('deposit_confirmed').checked;

            // –£—Ç–∞—Å–Ω—ã –¥—É–≥–∞–∞—Ä—ã–Ω —à–∞–ª–≥–∞–ª—Ç
            if (!/^\d{8}$/.test(phone)) {
                e.preventDefault();
                alert('–£—Ç–∞—Å–Ω—ã –¥—É–≥–∞–∞—Ä –∑”©–≤—Ö”©–Ω 8 –æ—Ä–æ–Ω—Ç–æ–π —Ç–æ–æ –±–∞–π—Ö —ë—Å—Ç–æ–π!');
                return false;
            }

            // –£—Ä—å–¥—á–∏–ª–≥–∞–∞ —Ç”©–ª—Å”©–Ω —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞—Ö
            if (!depositConfirmed) {
                e.preventDefault();
                alert('–¢–∞ —É—Ä—å–¥—á–∏–ª–≥–∞–∞ —Ç”©–ª—Å”©–Ω —ç—Å—ç—Ö—ç—ç –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–Ω–∞ —É—É!');
                return false;
            }
        });
    </script>
</body>
</html>
